<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@page import="static com.shachar.first.Utils.*"%>
<%@page import="java.util.Map"%>
<%@include file="dbMembers.jsp"%>
<%
	List<PollQuestion> pollQuestions = pollQuestionDatabase.getAllEntities();
%>
<!DOCTYPE html>
<html dir="rtl">
<head>
<link rel="stylesheet" type="text/css" href="style.css" />

<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<%@include file="header.jsp"%>
	<form action="dbPollAnswers.jsp" method="GET" accept-charset="UTF-8" name="poll">
		<table class="container poll_container">
			<%
				for (PollQuestion pollQuestion : pollQuestions) {
					String name = pollQuestion.getName();
					String id = pollQuestion.getId() + "";
			%>
			<tr>
				<%
					if (request.getSession().getAttribute("poll_results").equals("false")) {
				%>
				<td><label><%=name%></label>
				 <%
 					for (String answer : pollQuestion.getAllAnswers()) {
				%>
					  <span class="answer"><input type="radio"
						name="<%=id%>" id="<%=id %>" value="<%=answer%>"><span
						class="answer_text"> <%=answer%></span></span> <%
					}
				 %></td>
				<%
					} else {
							Map<String, Integer> answersCount = pollAnswerDatabase.getAnswerCounts(name);
							int ansSum = sum(answersCount.values());
				%>
				<td><label><%=name%></label> <%
 	for (String answer : pollQuestion.getAllAnswers()) {
 				Integer ansCount = answersCount.get(answer);
 				double ratio = 0;
 				if (ansCount != null) {
 					ratio = (double) ansCount / ansSum;
 				}
 %>
					<div class="answer"><%=answer%>
						<hr class="answer_mess" width=<%=270 * ratio%>><%=formatNumber(ratio * 100)%>%
					</div> <%
 	}
 		}
 %>
			</tr>
			<%
				}
				if (request.getSession().getAttribute("poll_results").equals("false")) {
			%>

			<tr>
				<td><input type="submit" value="שלח" class="post_button">
				</td>
			</tr>
			<%
				}
			%>
		</table>

	</form>


</body>
</html>