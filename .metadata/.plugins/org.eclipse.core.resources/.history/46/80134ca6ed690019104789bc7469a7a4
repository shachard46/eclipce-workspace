<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@page import="static com.shachar.first.Utils.*" %>
<%@page import="java.util.Map" %>
<%@include file="dbMembers.jsp"%>
<%
	List<PollQuestion> pollQuestions = pollQuestionDatabase.getAllEntities();
%>
<!DOCTYPE html>
<html dir="rtl">
<head>
<link rel="stylesheet" type="text/css" href="style.css" />

<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<%@include file="header.jsp"%>
	<form action="dbPollAnswers.jsp" method="GET" accept-charset="UTF-8">
		<table class="container poll_container">
			<%
				for (PollQuestion pollQuestion : pollQuestions) {
					String name = pollQuestion.getName();
					String id = pollQuestion.getId() + "";
			%>
			<tr>
				<%
					if (request.getSession().getAttribute("poll_results").equals("false")) {
				%>
				<td><label><%=name%></label> <span class="answer"><input
						type="radio" name="<%=id%>" value="<%=pollQuestion.getAns1()%>"><span
						class="answer_text"> <%=pollQuestion.getAns1()%></span></span> <span
					class="answer"><input type="radio" name="<%=id%>"
						value="<%=pollQuestion.getAns2()%>"><span
						class="answer_text"> <%=pollQuestion.getAns2()%></span></span> <span
					class="answer"><input type="radio" name="<%=id%>"
						value="<%=pollQuestion.getAns3()%>"><span
						class="answer_text"> <%=pollQuestion.getAns3()%></span></span> <span
					class="answer"><input type="radio" name="<%=id%>"
						value="<%=pollQuestion.getAns4()%>"><span
						class="answer_text"> <%=pollQuestion.getAns4()%></span></span></td>
				<%
					} else {
/* 						int ans_1_count = pollAnswerDatabase.pollAnswerCount(pollQuestion.getAns1());
						int ans_2_count = pollAnswerDatabase.pollAnswerCount(pollQuestion.getAns2());
						int ans_3_count = pollAnswerDatabase.pollAnswerCount(pollQuestion.getAns3());
						int ans_4_count = pollAnswerDatabase.pollAnswerCount(pollQuestion.getAns4());

						int ans_sum = ans_1_count + ans_2_count + ans_3_count + ans_4_count;
 */						
						Map<String,Integer> answersCount = pollAnswerDatabase.getAnswerCounts(name);
 						int ansSum = sum(answersCount.values());
 				%>
				<td><label><%=name%></label>
				<%	
						for(String answer: answersCount.keySet()){
							int ansCount = answersCount.get(answer);
							double ratio = (double)ansCount / ansSum;
							
				%>
					<div class="answer"><%=pollQuestion.getAns1()%>
						<hr class="answer_mess"
							width=<%=270 * ratio%>><%=ratio*100%>%
					</div>
				<%		}
					}
				%>
			</tr>
			<%
				}
				if (request.getSession().getAttribute("poll_results").equals("false")) {
			%>

			<tr>
				<td><input type="submit" value="שלח" class="post_button">
				</td>
			</tr>
			<%
				}
			%>
		</table>

	</form>


</body>
</html>